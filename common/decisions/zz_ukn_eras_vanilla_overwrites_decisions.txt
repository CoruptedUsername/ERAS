# Arcology Project
decision_arcology_project = {
	owned_planets_only = yes
	icon = decision_arcology_project

	prerequisites = {
		"tech_ukn_ecumenopolis"
	}

	enactment_time = 1800
	resources = {
		category = decisions
		cost = {
			influence = 100
			ukn_meta_materials = 4000
			consumer_goods = 1500
			minerals = 1000
		}
	}

	potential = {
		OR = {
			is_planet_class = pc_ukn_kyriopolis_dry
			is_planet_class = pc_ukn_kyriopolis_wet
			is_planet_class = pc_ukn_kyriopolis_cold
			is_planet_class = pc_ukn_kyriopolis_gaia
		}
		exists = owner
		#owner = { has_ascension_perk = ap_arcology_project }
	}

	allow = {
		if = {
			limit = { owner = { is_ai = no } }
			custom_tooltip = {
				fail_text = decision_arcology_project_requirements
				free_district_slots < 1
				num_districts = { type = district_farming value < 1 }
				num_districts = { type = district_mining value < 1 }
			}
		}
		num_uncleared_blockers < 1
	}

	effect = {
		# Make city-planet
		custom_tooltip = decision_arcology_project_effects
		hidden_effect = {
			clear_deposits = yes
			set_industrial_focus_flags = yes
			change_pc = pc_city
			relic_world_conversion_effect = {
				DISTRICT = district_arcology_housing
				VARIABLE = num_housing_districts
			}
			relic_world_conversion_effect = {
				DISTRICT = district_arcology_arms_industry
				VARIABLE = num_industrial_districts
			}
			set_ecu_industrial_districts_effect = yes
			set_planet_entity = {
				entity = "city_planet_entity"
				graphical_culture = owner
			}
			owner = {
				country_event = { id = distar.201 } # port for living planet distar.197, triggers in event
			}
			planet_event = { id = mega.200 }
			if = {
				limit = {
					OR = {
						is_active_resolution = "resolution_ecology_environmental_control_board"
						is_active_resolution = "resolution_ecology_paradise_initiative"
					}
				}
				owner = {
					set_timed_country_flag = { flag = resolution_breached_terraformed days = 3600 }
				}
			}
		}
	}

	ai_weight = {
		weight = 1
		modifier = {
			factor = 100
			exists = owner
			OR = {
				num_pops >= 70
				is_capital = yes
			}
		}
	}
}

# Advanced Habitat
decision_upgrade_habitat = {
	owned_planets_only = yes
	icon = decision_satellite_in_orbit

	enactment_time = 720
	resources = {
		category = megastructures_habitat
		cost = {
			influence = 25
			alloys = 1000
		}
	}

	potential = {
		is_planet_class = pc_habitat
		NOT = { has_planet_flag = advanced_habitat }
		exists = owner
		owner = {
			has_technology = tech_habitat_2
		}
	}

	allow = {
		free_district_slots = 0
	}

	effect = {
		hidden_effect = {
			set_planet_entity = {
				entity = "habitat_phase_02_entity"
				graphical_culture = owner
			}
			set_planet_flag = advanced_habitat
		}
		set_planet_size = 8
	}

	ai_weight = {
		weight = 1
	}
}

decision_upgrade_habitat_2 = {
	owned_planets_only = yes
	icon = decision_satellite_in_orbit

	enactment_time = 1440
	resources = {
		category = megastructures_habitat
		cost = {
			influence = 50
			alloys = 1500
		}
	}

	potential = {
		is_planet_class = pc_habitat
		has_planet_flag = advanced_habitat
		NOT = { has_planet_flag = advanced_habitat_2 }
		exists = owner
		owner = {
			has_technology = "tech_ukn_ecumenopolis"
		}
	}

	allow = {
		free_district_slots = 0
		has_major_upgraded_capital = yes
		num_districts = { type = district_hab_mining value < 1 }
	}

	effect = {
		change_pc = pc_ukn_ecu_habitat
		hidden_effect = {
			set_planet_entity = {
				entity = "habitat_phase_03_entity"
				graphical_culture = owner
			}
			set_planet_size = 8		#Redundancy you see
			set_planet_flag = advanced_habitat_2
		}
	}

	ai_weight = {
		weight = 1
	}
}